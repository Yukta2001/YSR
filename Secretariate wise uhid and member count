WITH mq AS (SELECT a.UHID_VALUE,LGD_DISTRICT_CODE,LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME,b.cnt family_cnt
FROM (SELECT UHID_VALUE,LGD_DISTRICT_CODE,LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME FROM tmp_final_argsri_card_print_image_latest_081223
WHERE FAMILY_HEAD = 'Y'
AND LGD_DIST_NAME IS NOT NULL
UNION ALL
SELECT UHID_VALUE,LGD_DISTRICT_CODE,LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME FROM tmp_card_print_set1_batch2
WHERE FAMILY_HEAD = 'Y'
AND LGD_DIST_NAME IS NOT NULL
UNION ALL
SELECT UHID_VALUE,LGD_DIST_NAME AS LGD_DISTRICT_CODE,LGD_DISTRICT_CODE AS LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME FROM temp_abha_card_print_v1
WHERE FAMILY_HEAD = 'Y'
AND LGD_DIST_NAME IS NOT NULL
UNION ALL
SELECT UHID_VALUE,LGD_DIST_NAME AS LGD_DISTRICT_CODE,LGD_DISTRICT_CODE AS LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME FROM temp_pds_card_print_v1
WHERE FAMILY_HEAD = 'Y'
AND LGD_DIST_NAME IS NOT NULL
UNION ALL
SELECT UHID_VALUE,LGD_DISTRICT_CODE,LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME FROM tmp_card_print_set2_batch1_final
WHERE FAMILY_HEAD = 'Y'
AND LGD_DIST_NAME IS NOT NULL
UNION ALL
SELECT UHID_VALUE,LGD_DISTRICT_CODE,LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME FROM tmp_card_print_set2_batch2_final
WHERE FAMILY_HEAD = 'Y'
AND LGD_DIST_NAME IS NOT NULL
UNION ALL
SELECT UHID_VALUE,LGD_DISTRICT_CODE,LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME FROM tmp_card_print_set2_batch3_final
WHERE FAMILY_HEAD = 'Y'
AND LGD_DIST_NAME IS NOT NULL
UNION ALL
SELECT UHID_VALUE,LGD_DISTRICT_CODE,LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME FROM tmp_card_print_set2_batch4_final
WHERE FAMILY_HEAD = 'Y'
AND LGD_DIST_NAME IS NOT NULL) a
 
INNER JOIN 
(SELECT UHID_VALUE, COUNT(*) cnt FROM (
SELECT UHID_VALUE FROM tmp_final_argsri_card_print_image_latest_081223
UNION ALL
SELECT UHID_VALUE FROM tmp_card_print_set1_batch2
UNION ALL
SELECT UHID_VALUE FROM temp_abha_card_print_v1
UNION ALL
SELECT UHID_VALUE FROM temp_pds_card_print_v1
UNION ALL
SELECT UHID_VALUE FROM tmp_card_print_set2_batch1_final
UNION ALL
SELECT UHID_VALUE FROM tmp_card_print_set2_batch2_final
UNION ALL
SELECT UHID_VALUE FROM tmp_card_print_set2_batch3_final
UNION ALL
SELECT UHID_VALUE FROM tmp_card_print_set2_batch4_final
)
GROUP BY UHID_VALUE
) b
 
ON a.uhid_value = b.uhid_value)
 
SELECT LGD_DISTRICT_CODE,LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME, COUNT(*) card_count, SUM(family_cnt) fmly_member_cnt FROM mq
GROUP BY LGD_DISTRICT_CODE,LGD_DIST_NAME,LGD_MANDAL_CODE,LGD_MANDAL_NAME,LGD_SECRETARIAT_ID,LGD_SECRETARIAT_NAME;
