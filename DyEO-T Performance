WITH mq as
(SELECT 
a.CASE_ID,
a.CASE_STATUS,
b.cmb_dtl_name
FROM ASRIT_CASE a
LEFT JOIN ASRIM_COMBO b ON a.CASE_STATUS = b.cmb_dtl_id
WHERE a.LST_UPD_DT BETWEEN '19-SEP-23' AND '10-FEB-24')
SELECT ac.CASE_ID,au.USER_ID,au.LOGIN_NAME,
au.FIRST_NAME||' '||AU.LAST_NAME as user_name,
au.LST_UPD_DT,ac.ACT_ID,ab.cmb_dtl_name AS ACTION_TAKEN,mq.cmb_dtl_name AS PRESENT_STATUS
FROM ASRIT_AUDIT ac
LEFT JOIN ASRIM_USERS au ON ac.ACT_BY = au.USER_ID
LEFT JOIN ASRIM_COMBO ab ON ac.ACT_ID = ab.cmb_dtl_id
JOIN mq ON mq.CASE_ID=ac.CASE_ID
WHERE au.USER_ROLE IN ('CD212','CD15634','CD7')
AND au.LOGIN_NAME='AP_C372_CD212'
UNION ALL
SELECT a.CASE_ID,d.USER_ID,d.LOGIN_NAME,
d.FIRST_NAME||' '||d.LAST_NAME as user_name,
d.LST_UPD_DT,c.ACT_ID,e.cmb_dtl_name AS ACTION_TAKEN,a.cmb_dtl_name AS PRESENT_STATUS
FROM
mq a
JOIN ASRIT_CASE_FOLLOWUP_CLAIM b ON a.case_id = b.case_id
LEFT JOIN asrit_followup_audit c ON b.case_followup_id = c.case_followup_id
LEFT JOIN ASRIM_USERS d ON c.ACT_BY = d.USER_ID
LEFT JOIN ASRIM_COMBO e ON c.ACT_ID = e.cmb_dtl_id
WHERE d.USER_ROLE IN ('CD931')
AND d.LOGIN_NAME='AP_C372_CD212';
